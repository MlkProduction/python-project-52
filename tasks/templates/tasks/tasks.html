{% extends "base.html" %}
{% load django_bootstrap5 %}
{% load i18n %}

{% block title %}{% translate "Задачи" %}{% endblock %}

{% block content %}
  <h2 class="mb-4">{% translate "Задачи" %}</h2>
  
  <div class="card mb-4">
    <div class="card-header">
      <h5 class="mb-0">{% translate "Фильтр" %}</h5>
    </div>
    <div class="card-body">
      <form method="get" class="row g-3">
        <div class="col-md-3">
          {% bootstrap_field filter.form.status show_label=True %}
        </div>
        <div class="col-md-3">
          {% bootstrap_field filter.form.executor show_label=True %}
        </div>
        <div class="col-md-3">
          {% bootstrap_field filter.form.labels show_label=True %}
        </div>
        <div class="col-md-3">
          {% bootstrap_field filter.form.self_tasks show_label=True %}
        </div>
        <div class="col-12">
          <button type="submit" class="btn btn-primary">{% translate "Показать" %}</button>
          <a href="{% url 'tasks:tasks' %}" class="btn btn-secondary">{% translate "Сбросить" %}</a>
        </div>
      </form>
    </div>
  </div>
  
  <a href="{% url 'tasks:tasks:tasks_create' %}" class="btn btn-success mb-3">{% translate "Создать задачу" %}</a>
  
  <table class="table mt-3 table-bordered table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Имя</th>
        <th>Статус</th>
        <th>Автор</th>
        <th>Исполнитель</th>
        <th>Дата создания</th>
        <th>Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td>{{ task.id }}</td>
        <td><a href="{% url 'tasks:tasks:tasks_detail' pk=task.id %}">{{ task.name }}</a></td>
        <td>{% if task.status %}{{ task.status.name}}{% else %}-{% endif %}</td>
        <td>{% if task.author %}{{ task.author.get_full_name|default:task.author.username }}{% else %}-{% endif %}</td>
        <td>{% if task.executor %}{{ task.executor.get_full_name|default:task.executor.username }}{% else %}-{% endif %}</td>
        <td>{{ task.created_at }}</td>
        <td>
          <a class="btn btn-sm btn-outline-primary"
             href="{% url 'tasks:tasks:tasks_edit' pk=task.id %}">
            {% translate "Изменить" %}
          </a>
          <a class="btn btn-sm btn-outline-danger"
             href="{% url 'tasks:tasks:tasks_delete' pk=task.id %}">
            {% translate "Удалить" %}
          </a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}